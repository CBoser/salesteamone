================================================================================
RICHMOND HIERARCHY MAP
================================================================================
Session 1.1: Richmond Plan Analysis (1 hour)
Date: Tuesday, November 11, 2025
Source: richmond_structure.txt, item_numbering_patterns.txt, BAT_FILES_ANALYSIS.md
Purpose: Document how Richmond currently encodes the Plan → Elevation → 
         Option → Material hierarchy

================================================================================
1. HOW IS PLAN ENCODED?
================================================================================

ANSWER: Richmond encodes plan in THREE different ways (inconsistent!)

ENCODING LOCATION 1: Sheet Name
-------------------------------
Examples:
  ✓ G603                - Plan G603 (base, all elevations)
  ✓ G914                - Plan G914 (base)
  ✓ LE93 G603B          - Luden Estates Lot 93, Plan G603, Elevation B
  ✓ LE94 G603A          - Luden Estates Lot 94, Plan G603, Elevation A
  ✓ 1649A PTO GG        - Plan 1649, Elevation A, Parr Takeoff, Golden Grove
  ✓ 1890ABD CR          - Plan 1890, Elevations A/B/D, Creek Ridge
  ✓ 2299A PTO GG        - Plan 2299, Elevation A, Parr Takeoff, Golden Grove

THREE DISTINCT NAMING PATTERNS:

Pattern 1: [Plan Number Only]
  - Examples: G603, G914
  - Usage: Multi-elevation base plans
  - Elevation handling: All elevations in one sheet
  - Plan location: Sheet name

Pattern 2: [Community Code] [Plan Number][Elevation]
  - Examples: LE93 G603B, LE94 G603A
  - Usage: Specific lot/variant in community
  - Elevation handling: Single elevation per sheet
  - Plan location: Sheet name (middle part)

Pattern 3: [Plan][Elevations] [Descriptor] [Community]
  - Examples: 1649A PTO GG, 1890ABD CR
  - Usage: Community-specific plans
  - Elevation handling: Single or multiple
  - Plan location: Sheet name (first part)
  - Community codes: GG=Golden Grove, CR=Creek Ridge

ENCODING LOCATION 2: Header Section (Row 3)
-------------------------------------------
Every plan sheet has:
  Row 2: Plan Overview - [Plan Name]
  Row 3: Model - [Plan Number]  ← PLAN ENCODED HERE

Example from G603 sheet:
  Row 3: "G603"

This is the AUTHORITATIVE plan identifier within each sheet.

ENCODING LOCATION 3: Plan Index Sheet
--------------------------------------
Column 1: "Plan Sheet" (sheet name)
Column 2: "Model" (plan identifier) ← PLAN ENCODED HERE

Current Plans in Richmond BAT (9 plans):
1. G603        - Base plan with elevations A, B, C
2. G914        - Base plan
3. LE94 G603A  - Lot-specific variant
4. LE93 G603B  - Lot-specific variant
5. 1890ABD     - Multi-elevation plan (A, B, D)
6. 1649A       - Single elevation plan
7. 2299A       - Single elevation plan
8. TEMPLATE    - Template sheet
9. BLANK ORIG  - Original blank template

PLAN INDEX STRUCTURE (9 rows × 10 columns):
  1. Plan Sheet        - Sheet name (mixed formats)
  2. Model             - Plan identifier (authoritative) ← KEY FIELD
  3. Elevations        - Letters (A, B, C, "A, B, C")
  4. Garage            - Configuration (2-Car L, 2-Car R)
  5. Living Area Total - Square feet
  6. Living Area Main  - Main floor SF
  7. Living Area Upper - Upper floor SF
  8. Garage Area       - Garage SF
  9. Date              - Last modified timestamp
 10. Bid Number        - (appears empty)

âš ï¸  CRITICAL FINDING: NO CONSISTENT STANDARD
- Sheet names use 3 different formats
- Plan Index "Model" column is most authoritative
- Community codes are optional (not always present)
- Lot numbers sometimes included (LE93, LE94)

================================================================================
2. HOW IS ELEVATION ENCODED?
================================================================================

ANSWER: Richmond uses TRIPLE ENCODING (problematic!)

ENCODING LOCATION 1: Sheet Name (sometimes)
-------------------------------------------
Examples:
  ✓ LE93 G603B          - Elevation B in sheet name
  ✓ LE94 G603A          - Elevation A in sheet name
  ✓ 1649A PTO GG        - Elevation A in sheet name
  ✓ 1890ABD CR          - Elevations A, B, D in sheet name
  ✗ G603                - NO elevation in sheet name (all elevations)
  ✗ G914                - NO elevation in sheet name

Pattern: Single-elevation sheets include elevation in name.
         Multi-elevation sheets do NOT.

ENCODING LOCATION 2: Header Section (Row 4)
-------------------------------------------
Every plan sheet has:
  Row 4: Elevations - [A, B, C, etc.]

Examples:
  G603 sheet → Row 4: "A, B, C"
  LE93 G603B sheet → Row 4: "B"
  1890ABD CR sheet → Row 4: "A, B, D"

This tells you which elevations are included in THIS sheet.

ENCODING LOCATION 3: Location String (Pack IDs)
-----------------------------------------------
Format: |[Phase] [PHASE NAME] - [ELV Codes]

Examples:
  |10 FOUNDATION - ELVA - ELVB - ELVC
  |11 MAIN JOIST SYSTEM - ELVA - ELVB - ELVC
  |20 MAIN WALLS READYFRAME - ELVB
  |10.82BCD OPT DEN FOUNDATION - ELVB - ELVC - ELVD

Elevation Code Structure:
  ELV + [Letter] = Elevation [Letter]
  
  ELVA = Elevation A
  ELVB = Elevation B
  ELVC = Elevation C
  ELVD = Elevation D

Multiple Elevations:
  "- ELVA - ELVB - ELVC" = applies to elevations A, B, and C

Single Elevation:
  "- ELVB" = applies only to elevation B

âš ï¸  PROBLEM: TRIPLE-ENCODING EXAMPLE

Location: |10.82BCD OPT DEN FOUNDATION - ELVB - ELVC - ELVD

This encodes elevation THREE times:
  1. In pack ID: "10.82BCD" (BCD = elevations B, C, D)
  2. In location string: "- ELVB - ELVC - ELVD"
  3. In option codes: ELVB, ELVC, ELVD (from reference sheet)

Maintenance burden:
  - Must update in 3 places if elevation changes
  - Risk of inconsistency (what if they don't match?)
  - Violates DRY (Don't Repeat Yourself) principle

Another example:
  |10BCD FOUNDATION - ELVB - ELVC - ELVD
  (Base foundation, but BCD encoded in pack ID)

âœ… BETTER PATTERN (not currently used):
  - Pack definition: "10.82 OPT DEN FOUNDATION" (no elevation)
  - Elevation availability: B, C, D (in ONE authoritative field)
  - Job selection: Which elevation customer chose (separate)

================================================================================
3. HOW DO OPTIONS RELATE TO PLANS?
================================================================================

ANSWER: Richmond uses TWO separate systems

SYSTEM 1: Pack IDs (Internal Organization)
------------------------------------------
Format: |[Major].[Minor][Suffix] [PACK NAME] - [Option Code]

Components:
  PIPE (|): Separates pack sections, hierarchy level
  MAJOR NUMBER: Construction phase (10, 11, 20, etc.)
  MINOR NUMBER: Variant within phase (.01, .60, .82, etc.)
  SUFFIX: Optional (x, tc, BCD, b)
  PACK NAME: Descriptive text
  OPTION CODE: Richmond's external code (after dash)

Examples:

BASE PACKS (no option):
  |10 FOUNDATION
  |11 MAIN JOIST SYSTEM
  |20 MAIN WALLS READYFRAME
  
  Usage: Standard items in all builds
  No option code needed

OPTION PACKS (with option):
  |10.01 OPT FOUNDATION - FPSING01
    Option: Fireplace Single (foundation level)
  
  |10.60x EXTENDED GREAT ROOM FOUNDATION - XGREAT
    Option: Extended Great Room
    Suffix 'x' = extension
  
  |10.61 SUNROOM FOUNDATION - SUN
    Option: Sunroom
  
  |10.82 OPT DEN FOUNDATION
    Option: Den (no external code shown here)
  
  |10.82BCD OPT DEN FOUNDATION - ELVB - ELVC - ELVD
    Same den option, but elevation-restricted to B, C, D
    (This is the problematic triple-encoding)
  
  |10.83BCD OPT DEN W/FULL BATH FOUNDATION - ELVB - ELVC - ELVD
    Den with bath variant (.83 vs .82)
  
  |10.tc TALLCRAWL FRAMING - TALLCRWL
    Option: Tall Crawl
    Suffix 'tc' = tall crawl
  
  |11.01 MAIN JOIST SYSTEM FIREPLACE ADD ON @FOUNDATION - FPSING
    Option: Fireplace (joist level)
    Note: FPSING vs FPSING01 inconsistency

PACK NUMBERING PATTERNS:
  - Sequential by construction phase: 09 → 10 → 11 → 18 → 20
  - Base packs: clean numbers (|10, |11)
  - Options: decimal variants (|10.01, |10.60x, |10.82)
  - Related options: sequential (.82 den, .83 den+bath)
  - Suffixes indicate types (x=extension, tc=special, BCD=elevation)

SYSTEM 2: Option Codes (External Communication)
-----------------------------------------------
These are Richmond's customer-facing codes for quotes/orders.

Examples:
  FPSING01  - Fireplace Single
  FPSING    - Fireplace Single (different variant)
  XGREAT    - Extended Great Room
  SUN       - Sunroom
  LOFT2     - Loft 2
  TALLCRWL  - Tall Crawl
  WO        - Walkout Basement
  WO2       - Walkout Basement variant 2
  3CARA     - 3-Car Garage (Elevation A)
  3CARB     - 3-Car Garage (Elevation B)
  3CARC     - 3-Car Garage (Elevation C)

Characteristics:
  - Abbreviations/acronyms (XGREAT, SUN, LOFT2)
  - Sometimes append numbers (FPSING01, WO2)
  - Separate from pack IDs
  - Used for external communication (quotes, orders)

âš ï¸  OPTION CODE CHANGES BY PLAN?

From Active_Contracts_-_BFS.xlsx analysis:
  - 192 unique Richmond option codes across 1,697 contracts
  - 46 active plans
  - Some options plan-specific, some universal

Examples:
  Universal options (work on multiple plans):
    FPSING01 - Fireplace (most plans)
    XGREAT - Extended Great Room (most plans)
  
  Plan-specific options:
    Some elevation codes only available on certain plans
    Community-specific options (GG, CR specific)

âš ï¸  OPTION CODE CHANGES BY ELEVATION?

YES, confirmed:
  3CARA - 3-Car Garage (Elevation A)
  3CARB - 3-Car Garage (Elevation B)
  3CARC - 3-Car Garage (Elevation C)
  
Pattern: Same option, different code per elevation

This is SEPARATE from the elevation encoding in pack IDs.

âœ… ONE OPTION, MULTIPLE USES?

Example: FPSING (Fireplace)
  - Appears in foundation pack: |10.01 ... - FPSING01
  - Appears in joist pack: |11.01 ... - FPSING
  - Same customer option, different implementation at different phases

This shows options CASCADE through construction phases:
  Customer selects: "Fireplace"
  System adds materials in:
    Phase 10 (Foundation)
    Phase 11 (Joists)
    Phase 20 (Walls)
    etc.

================================================================================
4. CURRENT TABLE RELATIONSHIPS
================================================================================

HOW DO SHEETS LINK TOGETHER?

Richmond uses a SHEET-BASED architecture (not database):

PLAN INDEX SHEET:
  - Lists all plans
  - Links to plan sheets via "Plan Sheet" column
  - No foreign keys (this is Excel, not SQL)

PLAN SHEETS (e.g., G603, G914, 1649A PTO GG):
  - Each sheet = one plan (or one plan-elevation combo)
  - Self-contained material list
  - No explicit links to other sheets
  - Links via SHEET NAME (text reference)

REFERENCE SHEETS:
  reference_PackNames:
    - 315 pack definitions
    - Maps pack IDs to option codes
    - Format: |[PackID] [PackName] - [OptionCode]
  
  reference_Subdivisions:
    - Community information
    - Not linked to plan sheets
  
  PRICING TAB:
    - Template for new plan sheets
    - Copied to create new plans

WHAT'S THE PRIMARY KEY?

In Excel sense:
  - Sheet name = "primary key" for plans
  - Pack ID (Column A) = "primary key" for materials within a sheet
  - NO actual database primary keys (this is Excel!)

In Database sense (what it SHOULD be):
  - Plan: Model (e.g., "G603")
  - Elevation: Letter (e.g., "A", "B", "C")
  - Pack: PackID (e.g., "10.01")
  - Material: LineItemID (needs to be created)

WHAT FORMULAS REFERENCE WHAT?

Limited formula usage observed:
  - Most data is static (not calculated)
  - Some quantity calculations in Column C (Tally/Notes)
  - Pricing calculations in later columns
  - NO cross-sheet references observed in materials section
  - Each sheet is SELF-CONTAINED

This means:
  âœ… Easy to migrate (no complex dependencies)
  âš ï¸  Redundant data (same material appears in multiple sheets)
  âš ï¸  Update burden (change material = update all sheets)

================================================================================
5. CRITICAL ARCHITECTURAL ISSUES IDENTIFIED
================================================================================

ISSUE 1: Inconsistent Plan Naming
----------------------------------
Problem: 3 different sheet naming patterns
Impact: 
  - Hard to find plans programmatically
  - No standard for new plans
  - Community codes optional
  
Solution Needed:
  - Standardize plan identifier (use "Model" from Plan Index)
  - Separate plan from elevation from community
  - Standard naming convention for database

ISSUE 2: Triple Encoding of Elevations
---------------------------------------
Problem: Elevation appears in 3 places (pack ID, location string, option code)
Impact:
  - Maintenance burden (update 3 places)
  - Risk of inconsistency
  - Harder to query
  
Solution Needed:
  - Store elevation ONCE in database
  - Use relationships to connect plan → elevation → pack
  - No redundant encoding

ISSUE 3: Pack ID and Option Code Confusion
-------------------------------------------
Problem: Two separate systems (internal packs vs external codes)
Impact:
  - Not clear which to use when
  - Some packs have option codes, some don't
  - Inconsistent code format (FPSING vs FPSING01)
  
Solution Needed:
  - Clarify relationship: Pack = internal organization
                         Option = customer-facing code
  - One pack can have 0 or 1 option codes
  - One option can span multiple packs (fireplace across phases)

ISSUE 4: Sheet-Level Duplication
---------------------------------
Problem: Same material appears in multiple plan sheets
Impact:
  - Update one material = update N sheets
  - Risk of version drift
  - Storage inefficiency
  
Solution Needed:
  - Normalize materials into separate table
  - Link materials to packs via relationships
  - Update once, affects all plans

ISSUE 5: Elevation Availability vs Selection
---------------------------------------------
Problem: No distinction between "elevation exists" vs "elevation selected"
Impact:
  - Can't easily query "which elevations are available for plan X?"
  - Can't track customer selection separate from plan definition
  
Solution Needed:
  - Plan → Elevations (which elevations exist for this plan)
  - Job → Elevation (which elevation customer selected)
  - Separate concept: availability vs selection

================================================================================
6. CURRENT SCALE
================================================================================

From Monday's Audit (ANALYSIS_SUMMARY.md):

Richmond System:
  - 56 plans (projected, currently 9 in sample BAT)
  - 55,605 material line items
  - 633 unique SKUs
  - 192 unique option codes
  - 1,697 contracts (Active_Contracts_-_BFS.xlsx)
  - 315 packs (reference_PackNames)

Sheet Dimensions (from sample):
  - G603: 502 rows × 50 columns
  - G914: 590 rows × 44 columns
  - LE93 G603B: 141 rows × 41 columns
  - 1649A PTO GG: 160 rows × 41 columns
  - 1890ABD CR: 305 rows × 41 columns

Pattern: 
  - Multi-elevation sheets (G603, G914): 500-600 rows
  - Single-elevation sheets (LE93, 1649A): 140-160 rows
  - Approximately 100-200 materials per elevation

================================================================================
7. RECOMMENDATIONS FOR DATABASE DESIGN
================================================================================

Based on current Richmond architecture:

RECOMMENDATION 1: Separate Plan from Elevation
  Current: Mixed in sheet names (1649A, G603B, vs G603)
  Future: plan_id + elevation_id as separate dimensions

RECOMMENDATION 2: Single Encoding of Elevation
  Current: |10.82BCD ... - ELVB - ELVC - ELVD (triple-encoded)
  Future: Store elevation in ONE authoritative location
          Use joins to retrieve elevation data where needed

RECOMMENDATION 3: Normalize Materials
  Current: Same material in multiple sheet/elevation combos
  Future: materials table (SKU, description, unit)
          plan_materials junction (which materials in which plan-elevation-pack)

RECOMMENDATION 4: Clarify Pack vs Option
  Current: Conflated (pack IDs with embedded option codes)
  Future: packs table (internal organization)
          options table (customer-facing codes)
          pack_options junction (which packs belong to which options)

RECOMMENDATION 5: Support Plan-Specific Packs
  Current: Unclear if packs are universal or plan-specific
  Future: Determine if packs are:
          - Universal (one pack used across all plans)
          - Plan-specific (each plan has own pack variants)
          See Tuesday Decision #1

================================================================================
OUTPUT: richmond_hierarchy_map.txt
================================================================================
Created: Tuesday, November 11, 2025
Next: Compare to Holt hierarchy (holt_hierarchy_map.txt)
Purpose: Feed into Tuesday Architecture Design decisions
